# Cleanup Package

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ€Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ· Ğ±Ğ°Ğ·Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ….

## ĞĞ¿Ğ¸Ñ

Cleanup scheduler Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ” Ğ·Ğ°ÑÑ‚Ğ°Ñ€Ñ–Ğ»Ñ– Ğ´Ğ°Ğ½Ñ– Ğ· Ğ±Ğ°Ğ·Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ´Ğ»Ñ Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– Ñ‚Ğ° ĞµĞºĞ¾Ğ½Ğ¾Ğ¼Ñ–Ñ— Ğ´Ğ¸ÑĞºĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ€Ñƒ.

## Ğ©Ğ¾ Ğ¾Ñ‡Ğ¸Ñ‰Ğ°Ñ”Ñ‚ÑŒÑÑ

### 1. Opportunities (Ğ·Ğ²Ğ¸Ñ‡Ğ°Ğ¹Ğ½Ñ– Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚Ñ–)
- **Retention:** 30 Ğ´Ğ½Ñ–Ğ²
- **ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ›Ğ°ÑƒĞ½Ñ‡Ğ¿ÑƒĞ»Ğ¸, Ğ°Ñ–Ñ€Ğ´Ñ€Ğ¾Ğ¿Ğ¸, Ñ‚Ğ° Ñ–Ğ½ÑˆÑ– opportunities Ğ·Ğ°Ğ·Ğ²Ğ¸Ñ‡Ğ°Ğ¹ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ–

### 2. Arbitrage Opportunities
- **Retention:** 7 Ğ´Ğ½Ñ–Ğ²
- **ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** ĞÑ€Ğ±Ñ–Ñ‚Ñ€Ğ°Ğ¶Ğ½Ñ– Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚Ñ– Ğ¼Ğ°ÑÑ‚ÑŒ Ğ´ÑƒĞ¶Ğµ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ life cycle (Ñ…Ğ²Ğ¸Ğ»Ğ¸Ğ½Ğ¸)
- **ĞŸÑ€Ğ¸Ğ¼Ñ–Ñ‚ĞºĞ°:** Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°ÑÑ‚ÑŒÑÑ Ğ´Ğ¾Ğ²ÑˆĞµ Ğ´Ğ»Ñ Ñ–ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ñ— Ğ°Ğ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ¸

### 3. DeFi Opportunities
- **Retention:** 7 Ğ´Ğ½Ñ–Ğ²
- **ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** APY ÑˆĞ²Ğ¸Ğ´ĞºĞ¾ Ğ·Ğ¼Ñ–Ğ½ÑÑÑ‚ÑŒÑÑ, ÑÑ‚Ğ°Ñ€Ñ– Ğ´Ğ°Ğ½Ñ– Ğ½Ğµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ–

### 4. Notifications
- **Sent notifications:** 90 Ğ´Ğ½Ñ–Ğ²
- **Failed notifications:** 30 Ğ´Ğ½Ñ–Ğ²
- **ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°ÑÑ‚ÑŒÑÑ Ğ´Ğ»Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ñƒ Ñ‚Ğ° troubleshooting

## Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´

**Default:** Ğ©Ğ¾Ğ´Ğ½Ñ Ğ¾ 2:00 AM (UTC)
**Cron expression:** `0 2 * * *`

## ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ

```go
config := &cleanup.Config{
    OpportunitiesRetentionDays:       30,
    ArbitrageRetentionDays:           7,
    DeFiRetentionDays:                7,
    SentNotificationsRetentionDays:   90,
    FailedNotificationsRetentionDays: 30,
    Schedule:                         "0 2 * * *",
}

scheduler := cleanup.NewScheduler(oppRepo, arbRepo, defiRepo, notifRepo, config)
```

## Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ

### ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº

Cleanup scheduler Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ñ‚ÑŒÑÑ Ğ² `cmd/bot/main.go`:

```go
cleanupScheduler := cleanup.NewScheduler(oppRepo, arbRepo, defiRepo, notifRepo, nil)
if err := cleanupScheduler.Start(); err != nil {
    log.Fatalf("Failed to start cleanup scheduler: %v", err)
}
defer cleanupScheduler.Stop()
```

### Ğ ÑƒÑ‡Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº (Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ)

```go
cleanupScheduler.RunNow()
```

## Ğ›Ğ¾Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ

Cleanup scheduler Ğ»Ğ¾Ğ³ÑƒÑ” Ğ²ÑÑ– Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ· ĞµĞ¼Ğ¾Ğ´Ğ¶Ñ– Ğ´Ğ»Ñ Ğ·Ñ€ÑƒÑ‡Ğ½Ğ¾ÑÑ‚Ñ– Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ñƒ:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§¹ Cleanup Job Started
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—‘ï¸  Cleaning up opportunities older than 30 days...
âœ… Opportunities cleanup completed
ğŸ—‘ï¸  Cleaning up arbitrage opportunities older than 7 days...
âœ… Arbitrage cleanup completed
ğŸ—‘ï¸  Cleaning up DeFi opportunities older than 7 days...
âœ… DeFi cleanup completed
ğŸ—‘ï¸  Cleaning up old notifications...
âœ… Notifications cleanup completed
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Cleanup completed in 234ms
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğ¸:
- Ğ§Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ cleanup Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ğ¹
- ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑÑ–Ğ²
- ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ¸ Ğ¿Ñ–Ğ´ Ñ‡Ğ°Ñ cleanup

## ĞŸĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ (TODO)

- [ ] Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑÑ–Ğ²)
- [ ] Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ backup before cleanup (optional)
- [ ] ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ‡ĞµÑ€ĞµĞ· config.yaml
- [ ] Email/Telegram Ğ°Ğ»ĞµÑ€Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°Ñ…
- [ ] ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑĞ¸Ğ²Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ (batches) Ğ´Ğ»Ñ Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†ÑŒ
